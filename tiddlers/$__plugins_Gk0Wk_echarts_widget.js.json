[
    {
        "title": "$:/plugins/Gk0Wk/echarts/widget.js",
        "type": "application/javascript",
        "module-type": "widget",
        "Modern.TiddlyDev#Origin": "widget/index.ts",
        "text": "\"use strict\";var __create=Object.create,__defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty,__copyProps=(e,i,r,s)=>{if(i&&\"object\"==typeof i||\"function\"==typeof i)for(let t of __getOwnPropNames(i))__hasOwnProp.call(e,t)||t===r||__defProp(e,t,{get:()=>i[t],enumerable:!(s=__getOwnPropDesc(i,t))||s.enumerable});return e},__toESM=(t,e,i)=>(i=null!=t?__create(__getProtoOf(t)):{},__copyProps(!e&&t&&t.__esModule?i:__defProp(i,\"default\",{value:t,enumerable:!0}),t)),import_widget=require(\"$:/core/modules/widgets/widget.js\"),ECharts=__toESM(require(\"$:/plugins/Gk0Wk/echarts/echarts.min.js\")),Function_=Function;if($tw.browser){globalThis.echarts=ECharts;try{$tw.modules.forEachModuleOfType(\"echarts-extension\",(t,e)=>{var i,r,s,n,h;\"$:/plugins/Gk0Wk/echarts-stat/ecStat.min.js\"===t&&(({transform:{histogram:r,clustering:s,regression:n},statistics:h}=e),null!=(i=ECharts.registerTransform)&&i(r),null!=(r=ECharts.registerTransform)&&r(s),null!=(i=ECharts.registerTransform)&&i(n),globalThis.EChartsStat=h)})}catch(error){console.error(error)}}var eChartsInstanceUnmountCheckTimer,echartWidgets=new Set,registerInstance=t=>{$tw.browser&&void 0===eChartsInstanceUnmountCheckTimer&&(echartWidgets.add(t),eChartsInstanceUnmountCheckTimer=setInterval(()=>{var t=[];for(const e of echartWidgets)document.contains(e.containerDom)||(unmountAddon(e.tiddlerTitle,e.state,e.echartsInstance),e.clearInstance(),t.push(e));for(const i of echartWidgets)echartWidgets[\"delete\"](i);echartWidgets.size<1&&(eChartsInstanceUnmountCheckTimer=void 0,clearInterval(eChartsInstanceUnmountCheckTimer))},1e3))},unmountAddon=(t,e,i)=>{var r,s,n,h,a;try{i.off(\"restore\"),t&&\"application/javascript\"===(null==(s=null==(r=$tw.wiki.getTiddler(t))?void 0:r.fields)?void 0:s.type)&&(a=(null!=(n=(h=require(t))[\"default\"])?n:h)[\"onUnmount\"],\"function\"==typeof a)&&a(e)}catch(error){console.error(error)}},nextId=0,EChartsWidget=class extends import_widget.widget{constructor(){super(...arguments),this.uuid=\"gk0wk-echarts-container-\"+nextId++,this.width=\"100%\",this.height=\"300px\",this[\"class\"]=\"gk0wk-echarts-body\",this.fillSidebar=!0,this.renderer=\"canvas\",this.skipDraftTiddle=!0}initialise(t,e){super.initialise(t,e),this.computeAttributes()}execute(){switch(this.tiddlerTitle=this.getAttribute(\"$tiddler\",\"\")||void 0,this.width=this.getAttribute(\"$width\",\"100%\"),this.height=this.getAttribute(\"$height\",\"300px\"),this[\"class\"]=this.getAttribute(\"$class\",\"gk0wk-echarts-body\"),this.fillSidebar=\"true\"===this.getAttribute(\"$fillSidebar\",\"true\").toLowerCase(),this.getAttribute(\"$theme\",\"auto\")){case\"light\":this.theme=void 0;break;case\"dark\":this.theme=\"dark\";break;default:this.theme=0<$tw.wiki.filterTiddlers(\"[{$:/palette}field:color-scheme[dark]]\").length?\"dark\":void 0}this.renderer=\"svg\"===this.getAttribute(\"$renderer\",\"canvas\")?\"svg\":\"canvas\",this.text=this.getAttribute(\"$text\",\"\").trim()||void 0;var t=this.getAttribute(\"$throttle\");t?(t=parseInt(t,10),this.throttle=Number.isSafeInteger(t)?Math.max(0,10):1e3):this.throttle=1e3,this.skipDraftTiddle=\"false\"!==this.getAttribute(\"$skipDraftTiddle\",\"true\")}render(t,e){this.parentDomNode=t,this.execute(),this.containerDom=$tw.utils.domMaker(\"div\",{\"class\":this[\"class\"],document:this.document,style:{width:this.width,height:this.height}}),this.containerDom.id=this.uuid,t.insertBefore(this.containerDom,e),this.domNodes.push(this.containerDom);try{if(!(this.tiddlerTitle&&$tw.wiki.getTiddler(this.tiddlerTitle)||this.text))throw new Error(\"Widget need either $tiddler or $text attribute!\");var i=Boolean(t.isTiddlyWikiFakeDom);this.rebuildInstance(i),this.initAddon(),this.renderAddon(),i?(Number.isSafeInteger(Number(this.width.replace(\"px\",\"\")))&&Number.isSafeInteger(Number(this.height.replace(\"px\",\"\")))||console.error(\"If you require SSR(server side render), you need to define $height and $width with format like '300px'\"),this.parentDomNode.innerHTML=this.echartsInstance.renderToSVGString()):registerInstance(this)}catch(error){console.error(error),this.containerDom.innerText=String(error),this.containerDom.style.color=\"white\",this.containerDom.style.background=\"red\",this.containerDom.style.fontSize=\"12px\"}}refresh(e){if(void 0!==this.timer)void 0!==this.tmpChangedTiddlers?this.tmpChangedTiddlers={...this.tmpChangedTiddlers,...e}:this.tmpChangedTiddlers=e;else{this.refresh_(e);let t=5;this.timer=setInterval(()=>{t--<=0&&void 0===this.tmpChangedTiddlers&&(clearInterval(this.timer),this.timer=void 0),void 0!==this.tmpChangedTiddlers&&(this.refresh_(this.tmpChangedTiddlers),this.tmpChangedTiddlers=void 0,t=Math.min(5,t+2))},this.throttle)}}refresh_(t){var e=this.tiddlerTitle;const i=this.computeAttributes();let r=0;if(0<$tw.utils.count(i)){let e=0;$tw.utils.each([\"$theme\",\"$fillSidebar\",\"$renderer\"],t=>{void 0!==i[t]&&e++}),0<e&&(r|=2),i.$class&&(e++,this[\"class\"]=this.getAttribute(\"$class\",\"gk0wk-echarts-body\"),this.containerDom.className=this[\"class\"]),i.$width&&(e++,this.width=this.getAttribute(\"$width\",\"100%\"),this.containerDom.style.width=this.width),i.$height&&(e++,this.height=this.getAttribute(\"$height\",\"300px\"),this.containerDom.style.height=this.height),$tw.utils.count(i)>e&&(r|=1)}void 0!==this.text||1&r||!(this.tiddlerTitle&&t[this.tiddlerTitle]||this.askForAddonUpdate(t,i))||(r|=1);var s=this.theme;this.execute(),s!==this.theme&&(r|=2),2&r?!(s=this.rebuildInstance())||1&r?(unmountAddon(void 0!==this.text?void 0:e,this.state,this.echartsInstance),this.initAddon(),this.renderAddon()):this.echartsInstance.setOption(s):1&r&&this.renderAddon()}askForAddonUpdate(t,e){var i,r,s,n,h,a,d,o,l,c;try{return this.tiddlerTitle&&$tw.wiki.getTiddler(this.tiddlerTitle)?(h=$tw.wiki.getTiddler(this.tiddlerTitle).fields,!(this.skipDraftTiddle&&h[\"draft.of\"]||\"_is_skinny\"in h&&null===$tw.wiki.getTiddlerText(this.tiddlerTitle))&&(a=h.type||\"text/vnd.tiddlywiki\",\"text/vnd.tiddlywiki\"===(d=null!=(r=(null!=(i=$tw.config.contentTypeInfo[a])?i:{}).deserializerType)?r:a)||\"application/json\"===d?(this._state=JSON.stringify($tw.wiki.filterTiddlers(h[\"echarts-refresh-trigger\"])),this._state!==this.state):\"application/javascript\"===d&&(void 0===(c=null!=(n=(l=null!=(s=(o=require(this.tiddlerTitle))[\"default\"])?s:o).shouldUpdate)?n:l.shouldRefresh)||(\"string\"==typeof c?(this._state=JSON.stringify($tw.wiki.filterTiddlers(c)),this._state!==this.state):\"function\"!=typeof c||c(this.state,t,e,this.attributes))))):!1}catch(error){return console.error(error),!1}}clearInstance(){let t;return this.echartsInstance&&(t=this.echartsInstance.getOption(),this.echartsInstance.isDisposed()||this.echartsInstance.dispose(),this.echartsInstance=void 0),this.containerDom.innerHTML=\"\",this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=void 0),t}rebuildInstance(t=!1){var e=this.clearInstance();return this.echartsInstance=ECharts.init(t?null:this.containerDom,this.theme,t?{ssr:!0,renderer:\"svg\",height:Number(this.height.replace(\"px\",\"\"))||300,width:Number(this.width.replace(\"px\",\"\"))||400}:{renderer:this.renderer}),this.echartsInstance.setOption({darkMode:\"dark\"===this.theme,backgroundColor:\"transparent\"}),globalThis.ResizeObserver&&$tw.browser&&!t&&(this.resizeObserver=new ResizeObserver(r=>{requestAnimationFrame(()=>{var e;if(this.echartsInstance){var i=document.querySelector(\".tc-sidebar-scrollable\");let t=r[0].contentRect[\"height\"];this.fillSidebar&&null!=(e=null==i?void 0:i.contains)&&e.call(i,this.containerDom)&&(t=window.innerHeight-this.parentDomNode.getBoundingClientRect().top-(Number(getComputedStyle(i).paddingBottom.replace(\"px\",\"\"))||0)),this.echartsInstance.resize({width:r[0].contentRect.width,height:t})}})}),this.resizeObserver.observe(this.containerDom)),e}initAddon(){var t,e,i,r,s;try{if(void 0===this.text){if(!this.tiddlerTitle||!$tw.wiki.getTiddler(this.tiddlerTitle))return;var n=$tw.wiki.getTiddler(this.tiddlerTitle).fields;if(\"_is_skinny\"in n&&null===$tw.wiki.getTiddlerText(this.tiddlerTitle))return;var h=n.type||\"text/vnd.tiddlywiki\",a=null!=(e=(null!=(t=$tw.config.contentTypeInfo[h])?t:{}).deserializerType)?e:h;if(\"text/vnd.tiddlywiki\"===a||\"application/json\"===a)this.state=null!=(i=this._state)?i:JSON.stringify($tw.wiki.filterTiddlers(n[\"echarts-refresh-trigger\"])),this._state=void 0;else{if(\"application/javascript\"!==a)return;var d=require(this.tiddlerTitle),o=null!=(r=d[\"default\"])?r:d,l=null!=(s=o.onMount)?s:o.onInit;\"function\"==typeof l&&(this.state=l(this.echartsInstance,this.attributes,this))}}this.echartsInstance.on(\"restore\",()=>this.renderAddon())}catch(error){console.error(error)}}async renderAddon(){var t,e,i;if(this.echartsInstance){this.echartsInstance.showLoading();try{if(void 0===this.text){if(!this.tiddlerTitle||!$tw.wiki.getTiddler(this.tiddlerTitle))return void this.echartsInstance.hideLoading();var r=$tw.wiki.getTiddler(this.tiddlerTitle).fields;if(\"_is_skinny\"in r&&null===$tw.wiki.getTiddlerText(this.tiddlerTitle))return;var s,n,h,a=r.type||\"text/vnd.tiddlywiki\",d=null!=(e=(null!=(t=$tw.config.contentTypeInfo[a])?t:{}).deserializerType)?e:a;\"text/vnd.tiddlywiki\"===d?(s=$tw.wiki.renderTiddler(\"text/plain\",this.tiddlerTitle,{variables:this.attributes}),n=new Function_(`return (${s})`)(),this.echartsInstance.setOption(n)):\"application/json\"===d?this.echartsInstance.setOption(JSON.parse($tw.wiki.getTiddlerText(this.tiddlerTitle))):\"application/javascript\"===d&&(null!=(i=(h=require(this.tiddlerTitle))[\"default\"])?i:h).onUpdate(this.echartsInstance,this.state,this.attributes)}else new Function_(\"myChart\",\"chartDom\",\"echarts\",\"$tw\",`var option;${this.text};if (option instanceof Object) myChart.setOption(option);`)(this.echartsInstance,this.containerDom,ECharts,$tw);var o=e=>t=>new Function_(\"params\",\"parentWidget\",`(${e})(params, parentWidget);`)(t,this.parentWidget),l=this.getAttribute(\"dblclick\");l&&this.echartsInstance.on(\"dblclick\",o(l))}catch(error){console.error(error)}this.echartsInstance.hideLoading()}}};exports.echarts=EChartsWidget;"
    }
]