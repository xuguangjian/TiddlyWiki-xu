[
    {
        "title": "$:/plugins/Gk0Wk/echarts/addons/TheBrain.js",
        "type": "application/javascript",
        "module-type": "echarts-component",
        "caption": "FocusMap",
        "echarts.author": "Gk0Wk(Sttot)",
        "echarts.readme": "{{$:/plugins/Gk0Wk/echarts/addons/TheBrain-readme}}",
        "Modern.TiddlyDev#IncludeSource": "false",
        "Modern.TiddlyDev#Origin": "addons/Gk0Wk/TheBrain/TheBrain.ts",
        "text": "\"use strict\";var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__export=(e,t)=>{for(var o in t)__defProp(e,o,{get:t[o],enumerable:!0})},__copyProps=(t,o,i,r)=>{if(o&&\"object\"==typeof o||\"function\"==typeof o)for(let e of __getOwnPropNames(o))__hasOwnProp.call(t,e)||e===i||__defProp(t,e,{get:()=>o[e],enumerable:!(r=__getOwnPropDesc(o,e))||r.enumerable});return t},__toCommonJS=e=>__copyProps(__defProp({},\"__esModule\",{value:!0}),e),TheBrain_exports={},colors=(__export(TheBrain_exports,{\"default\":()=>TheBrain_default}),module.exports=__toCommonJS(TheBrain_exports),[\"#5470c6\",\"#91cc75\",\"#fac858\",\"#ee6666\",\"#73c0de\",\"#3ba272\",\"#fc8452\",\"#9a60b4\",\"#ea7ccc\"]),CategoriesEn=[\"Focusing\",\"History\",\"Link To\",\"Backlink From\",\"Tag To\",\"Tag By\",\"Transclude\"].map((e,t)=>({name:e,itemStyle:{color:colors[t%colors.length]}})),CategoriesZh=[\"聚焦\",\"历史\",\"链接\",\"反链\",\"标签\",\"作为标签\",\"嵌套\"].map((e,t)=>({name:e,itemStyle:{color:colors[t%colors.length]}})),attributes=new Set([\"focussedTiddler\",\"levels\",\"graphTitle\",\"aliasField\",\"excludeFilter\",\"previewDelay\",\"focusBlur\",\"previewTemplate\",\"zoom\"]),getPlatteColor=e=>$tw.wiki.renderText(\"text/plain\",\"text/vnd.tiddlywiki\",`<$transclude tiddler={{$:/palette}} index=\"${e}\"><$transclude tiddler=\"$:/palettes/Vanilla\" index=\"${e}\"><$transclude tiddler=\"$:/config/DefaultColourMappings/${e}\"/></$transclude></$transclude>`,{}),findIcon=e=>{var t,o=null==(o=$tw.wiki.getTiddler(e))?void 0:o.fields;if(null!=o&&o.icon)return(t=null==(t=$tw.wiki.getTiddler(o.icon))?void 0:t.fields)?t._canonical_uri?\"image://\"+t._canonical_uri:t.title.startsWith(\"$:/core/images/\")?void 0:`image://data:${t.type};base64,`+t.text:/^https?:\\/\\//.test(o.icon)?\"image://\"+o.icon:void 0},getAliasOrTitle=(e,t)=>{var o;return void 0===t||\"title\"===t?[e,Boolean($tw.wiki.getTiddler(e))]:(o=$tw.wiki.getTiddler(e))?[\"string\"==typeof(o=o.fields[t])?$tw.wiki.renderText(\"text/plain\",\"text/vnd.tiddlywiki\",o,{variables:{currentTiddler:e}}):e,!0]:[e,!1]},TheBrainAddon={onMount:(s,e)=>{s.on(\"click\",{dataType:\"node\"},e=>{(new $tw.Story).navigateTiddler(e.data.name)});let n=4,c,p;const t=setInterval(()=>{var t=s.getOption(),o=null==(o=null==(o=null==t?void 0:t.series)?void 0:o[0])?void 0:o.zoom;if(\"number\"==typeof o){c||(c=t.tooltip.triggerOn,p=t.tooltip.showDelay);let e=!1;var i=Math.floor(4*o),r=2.5<=o,o=3<=o?p:2*p;if(t.series[0].label.show!==r&&(t.series[0].label.show=r,t.tooltip.triggerOn=r?c:\"none\",e=!0),t.tooltip.showDelay!==o&&(t.tooltip.showDelay=o,e=!0),i!==n){n=i,t.series[0].label.fontSize=Math.min(.5*n+2,24)+\"px\",t.series[0].lineStyle.width=Math.min(Math.max(.0625*n,.5),6),t.series[0].label.position=160<i?\"inside\":24<i?\"bottom\":\"right\";var l=Math.min(.75*n+3,30),a=l+\"px\";for(const d of t.series[0].nodes){if(0!==d.category)break;d.label.fontSize=a,d.itemStyle.borderWidth=l}e=!0}e&&s.setOption(t)}},200);return{historyTiddlers:[],viewingTiddlers:new Set,focusing:e.focussedTiddler,unmount:()=>{clearInterval(t)}}},onUnmount:({unmount:e})=>{e()},shouldUpdate:({viewingTiddlers:t,focusing:e,currentlyFocused:o},i,r)=>{var l;return Object.keys(i).some(e=>t.has(e))||Object.keys(r).some(e=>attributes.has(e))||void 0===e&&!0!==(null==o?void 0:o.has(null!=(l=$tw.wiki.getTiddlerText(\"$:/temp/focussedTiddler\"))?l:\"\"))},onUpdate:(i,r,u)=>{var e;let l=new Set;for(const t of u.focussedTiddler?$tw.wiki.filterTiddlers(u.focussedTiddler):[null!=(n=$tw.wiki.getTiddlerText(\"$:/temp/focussedTiddler\"))?n:\"\"])null!=(e=null==(e=$tw.wiki.getTiddler(t))?void 0:e.fields)&&e[\"draft.of\"]||l.add(t);if(0!==l.size){var d=new Set;for(const x of l){var s=null==(s=$tw.wiki.getTiddler(x))?void 0:s.fields[\"draft.of\"];s?d.add(s):d.add(x)}l=d,r.focusing=u.focussedTiddler,r.currentlyFocused=l,r.viewingTiddlers.clear();for(const O of l)r.viewingTiddlers.add(O);const T=[],k=[];var n=!0===(null==(n=$tw.wiki.getTiddlerText(\"$:/language\"))?void 0:n.includes(\"zh\"));let e=Number(u.levels);Number.isNaN(e)&&(e=1),e=Math.max(e,-1);var g=u.graphTitle||(n?\"聚焦\":\"Focusing Map\");const $=u.aliasField||\"caption\",S=\"\"===u.excludeFilter?void 0:$tw.wiki.compileFilter(null!=(h=u.excludeFilter)?h:\"[prefix[$:/]] [is[draft]]\"),_=new Map;for(const C of l)T.push({name:C,category:0,label:{formatter:getAliasOrTitle(C,$)[0],fontWeight:\"bold\",fontSize:\"15px\"},symbol:findIcon(C),symbolSize:15,select:{disabled:!0},itemStyle:{opacity:1,borderColor:colors[0]+\"66\",borderWidth:15},isTag:!1,tooltip:{show:!1}});let a=[];_.set(\"\",!1);for(const P of l)a.push(P),_.set(P,!0);if(S){var f=new Set(a);for(const M of S.call($tw.wiki,a))f[\"delete\"](M);a=Array.from(f)}for(var y=(e,t,o)=>{var i,r,l;return!(S&&0<S.call($tw.wiki,[e]).length)&&(([r,l]=void 0===(i=_.get(e))?getAliasOrTitle(e,$):[\"\",i]),void 0===i&&(T.push(t(r,l)),_.set(e,l),l)&&a.push(e),k.push(o(l)),l)};a.length&&0<e--;){var m=a;a=[];for(const z of m){for(const B of $tw.wiki.getTiddlerLinks(z))y(B,(e,t)=>({name:B,label:{formatter:e},itemStyle:{opacity:t?1:.5},symbol:findIcon(B),category:2,isTag:!1}),e=>({source:z,target:B,lineStyle:{color:colors[2],type:e?\"solid\":\"dashed\"}}));for(const N of $tw.wiki.getTiddlerBacklinks(z))y(N,(e,t)=>({name:N,label:{formatter:e},itemStyle:{opacity:t?1:.5},symbol:findIcon(N),category:3,isTag:!1}),e=>({source:N,target:z,lineStyle:{color:colors[3],type:e?\"solid\":\"dashed\"}}));for(const F of null!=(w=null==(w=null==(w=$tw.wiki.getTiddler(z))?void 0:w.fields)?void 0:w.tags)?w:[])y(F,(e,t)=>({name:F,label:{formatter:e},itemStyle:{opacity:t?1:.5},symbol:findIcon(F),category:4,isTag:!0}),e=>({source:z,target:F,lineStyle:{color:colors[4],type:e?\"solid\":\"dashed\"}}));for(const I of $tw.wiki.getTiddlersWithTag(z))y(I,(e,t)=>({name:I,label:{formatter:e},itemStyle:{opacity:t?1:.5},symbol:findIcon(I),category:5,isTag:!1}),e=>({source:I,target:z,lineStyle:{color:colors[5],type:e?\"solid\":\"dashed\"}}));var w=$tw.wiki.getTiddler(z);if(w){w=w.fields.type||\"text/vnd.tiddlywiki\";if(\"text/vnd.tiddlywiki\"===w||\"text/x-markdown\"===w){const D=new Set,A=e=>{var t=e[\"length\"];for(let r=0;r<t;r++){var o,i=e[r];\"tiddler\"===i.type?(o=null==(o=i.attributes.tiddler)?void 0:o.value)&&D.add(o):Array.isArray(i.children)&&A(i.children)}};A($tw.wiki.parseTiddler(z).tree);for(const W of D)y(W,(e,t)=>({name:W,label:{formatter:e},itemStyle:{opacity:t?1:.5},symbol:findIcon(W),category:6,isTag:!1}),e=>({source:z,target:W,lineStyle:{color:colors[6],type:e?\"solid\":\"dashed\"}}))}}}}if(1===l.size){var h=l.values().next().value;let t=h;var v=new Set;for(let e=r.historyTiddlers.length-2;0<=e;e--){const j=r.historyTiddlers[e];v.has(j)||j===t||j.startsWith(\"$:/\")||(y(j,(e,t)=>({name:j,label:{formatter:e},category:1,symbol:findIcon(j),symbolSize:3,itemStyle:{opacity:t?.65:.4},isTag:!1}),e=>({source:j,target:t,lineStyle:{color:colors[1],type:e?\"dashed\":\"dotted\",opacity:.5}})),t=j)}var b=r.historyTiddlers.indexOf(h);-1<b&&r.historyTiddlers.splice(b,1),r.historyTiddlers.push(h),r.historyTiddlers.slice(-10)}let c=\"\",p;let t=Number(u.zoom),o=((Number.isNaN(t)||Number.isFinite(t)||t<=0)&&(t=4),Number(u.previewDelay||\"1000\"));Number.isSafeInteger(o)||(o=-1);b=\"false\"!==(null==(h=null==(b=u.focusBlur)?void 0:b.toLowerCase)?void 0:h.call(b));i.setOption({backgroundColor:\"transparent\",legend:[{data:(n?CategoriesZh:CategoriesEn).map(e=>e.name),icon:\"circle\"}],title:{text:g,show:!0,top:\"bottom\",left:\"right\"},toolbox:{show:!0,left:0,bottom:0,feature:{restore:{},saveAsImage:{}}},tooltip:{position:\"top\",formatter:({data:{name:t,isTag:e},dataType:o})=>{if(\"node\"!==o)return[];if(t!==c||!p){var i=$tw.utils.domMaker(\"div\",{style:{maxWidth:\"40vw\",maxHeight:\"50vh\",overflowY:\"auto\",whiteSpace:\"normal\"},\"class\":\"gk0wk-echarts-thebrain-popuptiddler-container\"});if(e){var r=$tw.utils.domMaker(\"ul\",{}),l=$tw.wiki.getTiddlersWithTag(t),a=l.length;for(let e=0;e<a;e++){const n=l[e];var d=$tw.utils.domMaker(\"li\",{}),s=$tw.utils.domMaker(\"a\",{text:n,\"class\":\"tc-tiddlylink tc-tiddlylink-resolves tc-popup-handle tc-popup-absolute\",style:{cursor:\"pointer\"}});s.addEventListener(\"click\",()=>(new $tw.Story).navigateTiddler(n)),d.appendChild(s),r.appendChild(d)}p=[r]}else $tw.wiki.makeWidget($tw.wiki.parseTiddler(u.previewTemplate||\"$:/plugins/Gk0Wk/echarts/addons/TheBrainPopup\"),{document:document,parseAsInline:!0,variables:{currentTiddler:t}}).render(i,null),p=[i,$tw.utils.domMaker(\"style\",{innerHTML:\".gk0wk-echarts-thebrain-popuptiddler-container::-webkit-scrollbar {display: none;} .gk0wk-echarts-thebrain-popuptiddler-container .tc-tiddler-controls { display: none; }\"})];c=t}return p},triggerOn:0<=o?\"mousemove\":\"none\",enterable:!0,showDelay:Math.max(0,o),hideDelay:200,confine:!0,textStyle:{color:\"inherit\",fontFamily:\"inherit\",fontSize:\"inherit\"},appendToBody:!0,backgroundColor:getPlatteColor(\"page-background\"),borderColor:getPlatteColor(\"very-muted-foreground\")},series:[{name:g,type:\"graph\",layout:\"force\",top:0,bottom:0,left:0,right:0,height:\"100%\",width:\"100%\",nodes:T,edges:k,categories:n?CategoriesZh:CategoriesEn,roam:!0,draggable:!1,zoom:t,label:{position:\"right\",show:!0,fontSize:\"10px\",backgroundColor:\"transparent\"},labelLayout:{moveOverlap:!0},edgeLabel:{show:!1},force:{repulsion:50},cursor:\"pointer\",symbolSize:6,edgeSymbol:[\"none\",\"arrow\"],edgeSymbolSize:[0,5],lineStyle:{width:1,opacity:.75,curveness:.15},itemStyle:{opacity:.9},emphasis:{disabled:!b,focus:\"adjacency\",scale:1.2},blur:{itemStyle:{opacity:.3},lineStyle:{opacity:.3}}}]})}}},TheBrain_default=TheBrainAddon;"
    }
]